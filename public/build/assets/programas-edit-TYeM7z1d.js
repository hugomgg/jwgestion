function a(a,e,o){const n=`\n        <div class="alert alert-${e} alert-dismissible fade show" role="alert">\n            ${o}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        </div>\n    `;$("#"+a).html(n)}$(document).ready(function(){function a(a,e,o){const n=`\n            <div class="alert alert-${e} alert-dismissible fade show" role="alert">\n                ${o}\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n            </div>\n        `;$(`#${a}`).html(n)}function e(){const a=$("#programa_id").val();$.ajax({url:`/programas/${a}/partes-smm`,method:"GET",success:function(a){a.success?(partesSegundaSeccionTable.clear(),a.data.forEach(function(a,e){const o=a.numero,n=a.es_primero?"disabled":"",r=a.es_ultimo?"disabled":"";let i=`\n                            <div class="btn-group" role="group">\n                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="moveParteSegundaSeccionUp(${a.id})" title="Subir" ${n}>\n                                    <i class="fas fa-chevron-up"></i>\n                                </button>\n                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="moveParteSegundaSeccionDown(${a.id})" title="Bajar" ${r}>\n                                    <i class="fas fa-chevron-down"></i>\n                                </button>\n                                <button type="button" class="btn btn-sm btn-outline-info" onclick="verAsignacionDesdeTabla(${a.id})" title="Ver Asignación">\n                                    <i class="fas fa-eye"></i>\n                                </button>\n                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="editParteSegundaSeccion(${a.id})" title="Editar">\n                                    <i class="fas fa-edit"></i>\n                                </button>\n                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteParteSegundaSeccion(${a.id})" title="Eliminar">\n                                    <i class="fas fa-trash"></i>\n                                </button>\n                            </div>\n                        `,s="";s="SP"===a.sala_abreviacion?`<span class="badge bg-primary">${a.sala_abreviacion}</span>`:"S1"===a.sala_abreviacion?`<span class="badge bg-warning">${a.sala_abreviacion}</span>`:"S2"===a.sala_abreviacion?`<span class="badge bg-success">${a.sala_abreviacion}</span>`:'<span class="badge bg-secondary">-</span>';let t=[o,a.parte_abreviacion||"-",a.encargado_nombre||"-",a.ayudante_nombre||"-",s,a.tiempo||"-",a.leccion||"-",i];partesSegundaSeccionTable.row.add(t)}),partesSegundaSeccionTable.draw()):console.error("Error al cargar las partes de la segunda sección:",a.message)},error:function(a){console.error("Error al cargar las partes de la segunda sección:",a.responseText)}})}function o(){const e=$("#programa_id").val();$.ajax({url:`/programas/${e}/partes`,method:"GET",success:function(a){a.success&&(partesTable.clear(),a.data.forEach(function(a,e){const o=e+1,n=a.es_primero?"disabled":"",r=a.es_ultimo?"disabled":"";let i=`\n                            <div class="btn-group" role="group">\n                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="moveParteUp(${a.id})" title="Subir" ${n}>\n                                <i class="fas fa-chevron-up"></i>\n                            </button>\n                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="moveParteDown(${a.id})" title="Bajar" ${r}>\n                                <i class="fas fa-chevron-down"></i>\n                            </button>\n                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="editParte(${a.id})" title="Editar">\n                                <i class="fas fa-edit"></i>\n                            </button>\n                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteParte(${a.id})" title="Eliminar">\n                                <i class="fas fa-trash"></i>\n                            </button>\n                            </div>\n                        `,s=[o,a.parte_abreviacion||"-",a.encargado_nombre||"-",a.tema||"-",a.tiempo||"-"];s.push(i),partesTable.row.add(s)}),partesTable.draw())},error:function(e){a("alert-container","danger","Error al cargar las partes del programa")}})}function n(e){isEditMode=!0,$("#parteProgramaModalLabel").text("Editar Asignación de Tesoros de la Biblia"),$("#saveParteBtn").text("Actualizar Asignación"),$("#modal-alert-container").empty(),$("#encargado_reemplazado_id").val(""),$("#encargado_reemplazado_display").val(""),$("#parte_id").hide(),$("#parte_display").show(),$("#encargado_reemplazado_display").closest(".col-md-6").show(),$("#btn-agregar-reemplazado").show(),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$.ajax({url:`/partes-programa/${e}`,method:"GET",success:function(a){if(a.success){const e=a.data;$("#parte_programa_id").val(e.id),$("#tiempo_parte").val(e.tiempo),$("#tema_parte").val(e.tema),s(e.parte_id,function(){$("#encargado_id").val(e.encargado_id),$("#encargado_display").val(e.encargado?e.encargado.name:""),e.encargado_reemplazado_id&&e.encargado_reemplazado&&($("#encargado_reemplazado_id").val(e.encargado_reemplazado_id),$("#encargado_reemplazado_display").val(e.encargado_reemplazado.name),$("#btn-eliminar-reemplazado").prop("disabled",!1)),$("#btn-buscar-encargado").prop("disabled",!1),e.encargado_id?($("#btn-historial-encargado").prop("disabled",!1),$("#btn-agregar-reemplazado").prop("disabled",!1)):($("#btn-historial-encargado").prop("disabled",!0),$("#btn-agregar-reemplazado").prop("disabled",!0)),$("#parteProgramaModal").modal("show")})}},error:function(e){a("alert-container","danger","Error al cargar los datos de la parte")}})}function r(e,n=null){$("#confirmDeleteModal").modal("show"),$("#confirmDeleteBtn").off("click").on("click",function(){const r=$(this),i=r.html();r.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm me-2" role="status"></span>Eliminando...'),$.ajax({url:`/partes-programa/${e}`,method:"DELETE",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(a){a.success&&($("#confirmDeleteModal").modal("hide"),n&&"function"==typeof n?n():o(),$("#successModalMessage").text("Asignación eliminada exitosamente"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3))},error:function(e){var o;$("#confirmDeleteModal").modal("hide"),a("alert-container","danger",(null==(o=e.responseJSON)?void 0:o.message)||"Error al eliminar la parte")},complete:function(){r.prop("disabled",!1).html(i)}})})}function i(){const a=$("#programa_id").val();$("#parte_id").empty().append('<option value="">Cargando...</option>'),$.ajax({url:"/partes-secciones",method:"GET",data:{programa_id:a,parte_id:1},success:function(a){a.success?($("#parte_id").empty().append('<option value="">Seleccionar...</option>'),a.data.forEach(function(a){$("#parte_id").append(`<option value="${a.id}" data-tiempo="${a.tiempo||""}">${a.nombre} (${a.abreviacion})</option>`)})):$("#parte_id").empty().append('<option value="">No hay partes disponibles</option>')},error:function(a){console.error("Error al cargar partes de sección:",a),$("#parte_id").empty().append('<option value="">Error al cargar</option>')}})}function s(a,e){$("#parte_id").empty().append('<option value="">Cargando...</option>'),$.ajax({url:`/partes-seccion/${a}`,method:"GET",success:function(a){if(a.success){const o=a.data;$("#parte_id").empty(),$("#parte_id").append(`<option value="${o.id}" data-tiempo="${o.tiempo||""}" selected>${o.nombre} (${o.abreviacion})</option>`),$("#parte_display").val(o.nombre),$("#parte_id_hidden").val(o.id),o.tiempo&&$("#tiempo_parte").val(o.tiempo),"function"==typeof e&&e()}else $("#parte_id").empty().append('<option value="">Error al cargar la parte</option>'),"function"==typeof e&&e()},error:function(a){console.error("Error al cargar parte de sección:",a),$("#parte_id").empty().append('<option value="">Error al cargar</option>'),"function"==typeof e&&e()}})}function t(a){isEditMode=!0,$("#parteProgramaSegundaSeccionModalLabel").text("Editar Asignación"),$("#parte_programa_segunda_seccion_id").val(a),$("#saveParteSegundaSeccionBtn").text("Actualizar Asignación"),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#modal-alert-container-segunda-seccion").empty(),$("#parteProgramaSegundaSeccionForm")[0].reset(),$("#parte_id_segunda_seccion").empty().append('<option value="">Seleccionar...</option>'),$("#encargado_display_segunda_seccion").val("Seleccionar..."),$("#encargado_id_segunda_seccion").val(""),$("#ayudante_display_segunda_seccion").val("Seleccionar..."),$("#ayudante_id_segunda_seccion").val(""),d(),l(),$("#campos-reemplazados-segunda-seccion").show(),$("#btn-agregar-encargado-reemplazado").show(),$("#btn-agregar-ayudante-reemplazado").show(),$("#btn-encargado-reemplazado-segunda").show(),$("#btn-ayudante-reemplazado-segunda").show(),function(a){const e=$("#programa_id").val();$.ajax({url:`/programas/${e}/partes-segunda-seccion-disponibles`,method:"GET",data:{include_selected:a},async:!1,success:function(e){if(e.success){const o=$("#parte_id_segunda_seccion");o.empty().append('<option value="">Seleccionar...</option>'),e.data.forEach(function(e){const n=e.id==a?"selected":"";o.append(`<option value="${e.id}"  data-tiempo="${e.tiempo}" data-tipo="${e.tipo}" data-abreviacion="${e.abreviacion}" ${n}>${e.abreviacion} - ${e.nombre}</option>`)})}},error:function(a){console.error("Error al cargar las partes disponibles:",a.responseText)}})}(a),window.editingParteTwoData=!0,$.ajax({url:`/partes-programa/${a}`,method:"GET",success:function(a){if(a.success){const e=a.data;$("#parteProgramaSegundaSeccionModalLabel").text("Editar Asignación Seamos Mejores Maestros"),$("#sala_id_segunda_seccion").val(e.sala_id),$("#parte_id_segunda_seccion").val(e.parte_id),$("#tiempo_segunda_seccion").val(e.tiempo),$("#leccion_segunda_seccion").val(e.leccion),e.encargado_id&&($("#encargado_id_segunda_seccion").val(e.encargado_id),$("#encargado_display_segunda_seccion").val(e.encargado_nombre)),$("#ayudante_id_segunda_seccion").val(e.ayudante_id),$("#ayudante_display_segunda_seccion").val(e.ayudante_nombre),$("#tema_segunda_seccion").val(e.tema),e.encargado_reemplazado?($("#encargado_reemplazado_segunda_seccion").val(e.encargado_reemplazado.name),$("#encargado_reemplazado_id_segunda_seccion").val(e.encargado_reemplazado.id)):($("#encargado_reemplazado_segunda_seccion").val(""),$("#encargado_reemplazado_id_segunda_seccion").val("")),e.ayudante_reemplazado?($("#ayudante_reemplazado_segunda_seccion").val(e.ayudante_reemplazado.name),$("#ayudante_reemplazado_id_segunda_seccion").val(e.ayudante_reemplazado.id)):($("#ayudante_reemplazado_segunda_seccion").val(""),$("#ayudante_reemplazado_id_segunda_seccion").val("")),$("#parteProgramaSegundaSeccionModal").modal("show"),u()}},error:function(a){console.error("Error al cargar la parte:",a.responseText),window.editingParteTwoData=!1}})}function c(a){$("#confirmDeleteBtn").off("click").on("click",function(){$.ajax({url:`/partes-programa/${a}`,method:"DELETE",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(a){a.success&&(e(),$("#confirmDeleteModal").modal("hide"),$("#successModalMessage").text("Asignación eliminada exitosamente"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3))},error:function(a){console.error("Error al eliminar la parte:",a.responseText)}})}),$("#confirmDeleteModal").modal("show")}function d(){$("#encargado_reemplazado_segunda_seccion").val(""),$("#encargado_reemplazado_id_segunda_seccion").val("")}function l(){$("#ayudante_reemplazado_segunda_seccion").val(""),$("#ayudante_reemplazado_id_segunda_seccion").val("")}function p(){const a=$("#encargado_id_segunda_seccion").val(),e=$("#encargado_display_segunda_seccion").val();a&&e?($("#encargado_reemplazado_segunda_seccion").val(e),$("#encargado_reemplazado_id_segunda_seccion").val(a)):alert("Por favor seleccione un encargado primero")}function u(){const a=$("#encargado_id_segunda_seccion").val(),e=$("#ayudante_id_segunda_seccion").val(),o=$("#parte_id_segunda_seccion").val(),n=$("#btn-buscar-encargado-segunda"),r=$("#btn-buscar-ayudante-segunda");if(a?($("#btn-encargado-reemplazado-segunda").prop("disabled",!1),n.prop("disabled",!1),n.attr("title","Buscar Estudiante")):($("#btn-encargado-reemplazado-segunda").prop("disabled",!0),n.prop("disabled",!0),n.attr("title","Seleccionar estudiante primero")),a&&""!==a&&o){const a=$("#parte_id_segunda_seccion").find("option:selected").data("tipo");2==a||3==a?(r.prop("disabled",!1),r.attr("title","Buscar Ayudante")):(r.prop("disabled",!0),r.attr("title","No disponible para este tipo de parte"))}else r.prop("disabled",!0),r.attr("title","Seleccionar estudiante y parte con tipo 2 o 3");e?$("#btn-ayudante-reemplazado-segunda").prop("disabled",!1):$("#btn-ayudante-reemplazado-segunda").prop("disabled",!0)}function g(a){const e=event.target.closest("button");e&&e.disabled||f(a,"up")}function _(a){const e=event.target.closest("button");e&&e.disabled||f(a,"down")}function m(a){const e=event.target.closest("button");e&&e.disabled||f(a,"up")}function v(a){const e=event.target.closest("button");e&&e.disabled||f(a,"down")}function f(n,r,i){const s=`/partes-programa/${n}/move-${r}`;$.ajax({url:s,method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(n){n.success?(i&&"function"==typeof i?i():(o(),e()),a("alert-container","success",n.message)):a("alert-container","warning",n.message)},error:function(e){var o;console.error("AJAX error:",e);a("alert-container","danger",(null==(o=e.responseJSON)?void 0:o.message)||"Error al mover la parte")}})}function h(a,e){$.ajax({url:"/canciones-disponibles",method:"GET",success:function(o){if(o.success){const n=$("#"+a);if(n.empty(),!n.hasClass("select2-hidden-accessible")){const e=a.includes("inicial")?"#buscarCancionInicialModal":a.includes("intermedia")?"#buscarCancionIntermediaModal":"#buscarCancionFinalModal";n.select2({theme:"bootstrap-5",placeholder:"Buscar y seleccionar canción...",allowClear:!0,width:"100%",dropdownParent:$(e)})}n.append('<option value="">Seleccionar canción...</option>'),o.data.forEach(function(a){const e=a.numero?`${a.numero} - ${a.nombre}`:a.nombre;n.append(`<option value="${a.id}">${e}</option>`)});const r=$(e).val();r&&n.val(r).trigger("change")}else alert("Error al cargar las canciones: "+o.message)},error:function(a){alert("Error al cargar las canciones"),console.error(a)}})}function b(){const a=$("#parte_id").val();a?($("#buscarEncargadoParteModalLabel").html('<i class="fas fa-search me-2"></i>Buscar Encargado'),$("#buscarEncargadoParteModal").modal("show"),$("#confirmarEncargadoParte").prop("disabled",!0),$.ajax({url:`/encargados-por-parte-programa/${a}`,method:"GET",success:function(e){if(e.success){const o=$("#select_encargado_parte");o.empty(),o.hasClass("select2-hidden-accessible")||o.select2({theme:"bootstrap-5",placeholder:"Buscar y seleccionar encargado...",allowClear:!0,width:"100%",dropdownParent:$("#buscarEncargadoParteModal")}),o.append('<option value="">Seleccionar encargado...</option>'),e.data.forEach(function(a){o.append(`<option value="${a.id}">${a.display_text}</option>`)});const n=$("#select_historial_encargado_parte");n.hasClass("select2-hidden-accessible")||n.select2({theme:"bootstrap-5",placeholder:"Historial del Encargado...",width:"100%",dropdownParent:$("#buscarEncargadoParteModal")});const r=$("#encargado_id").val();r&&(o.val(r),y(r,a)),o.off("change.historial").on("change.historial",function(){const a=$(this).val(),e=$("#parte_id").val();if($("#confirmarEncargadoParte").prop("disabled",!a),a&&e)y(a,e);else{const a=$("#select_historial_encargado_parte");a.empty().append('<option value="">Seleccione un encargado primero...</option>'),a.prop("disabled",!0)}})}else alert("Error al cargar los usuarios: "+e.message)},error:function(a){alert("Error al cargar los usuarios para encargado"),console.error(a)}})):alert("Por favor seleccione una parte primero")}function y(a,e){const o=$("#select_historial_encargado_parte");o.empty(),o.append('<option value="">Cargando historial...</option>'),o.prop("disabled",!0),$.ajax({url:`/usuarios/${a}/historial-participaciones`,method:"GET",data:{parte_id:e,tipo:"encargado"},success:function(a){a.success?(o.empty(),a.data.length>0?(o.append('<option value="">Seleccionar participación...</option>'),a.data.forEach(function(a){const e=new Date(a.fecha),n=`${`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}|${a.parte_abreviacion}|${a.nombre_usuario||"Usuario"}`;o.append(`<option value="${a.programa_id}">${n}</option>`)}),o.prop("disabled",!1),o.val(a.data[0].programa_id).trigger("change")):(o.append('<option value="">No hay participaciones registradas como encargado</option>'),o.prop("disabled",!0))):(o.empty(),o.append('<option value="">Error al cargar historial</option>'),o.prop("disabled",!0))},error:function(a){o.empty(),o.append('<option value="">Error al cargar historial</option>'),o.prop("disabled",!0),console.error(a)}})}function p(){const a=$("#encargado_id").val(),e=$("#encargado_display").val();a&&e?($("#encargado_reemplazado_id").val(a),$("#encargado_reemplazado_display").val(e),$("#btn-eliminar-reemplazado").prop("disabled",!1)):alert("No hay encargado seleccionado para agregar como reemplazado")}function S(){$('input[name="filtro_sexo_encargado_segunda"]').prop("checked",!1),$("#filtro_mujeres_encargado_segunda").prop("checked",!0),$('input[name="filtro_sexo_encargado_segunda"]').prop("disabled",!1),$('input[name="filtro_sexo_encargado_segunda"][value="1"]').closest(".form-check").show(),$('input[name="filtro_sexo_encargado_segunda"][value="2"]').closest(".form-check").show()}function w(a,e,o){const n=$("#select_historial_encargado_segunda_seccion");n.empty().append('<option value="">Cargando historial...</option>'),n.prop("disabled",!1),$.ajax({url:`/usuarios/${a}/${e}/historial-segunda-seccion`,method:"GET",success:function(a){a.success?(n.empty(),a.historial.length>0?(n.append('<option value="">Seleccionar participación...</option>'),a.historial.forEach(function(a){const e=new Date(a.fecha),o=`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`,r=a.encargado_nombre_formateado||"",i=a.ayudante_nombre_formateado||"",s=`${o}|${a.sala_abreviacion}|${a.parte_abreviacion}|ES|${r}|AY|${i}`;n.append(`<option value="${a.programa_id}">${s}</option>`)}),n.prop("disabled",!1),a.historial.length>0&&n.val(a.historial[0].programa_id).trigger("change")):(n.append('<option value="">No hay participaciones registradas</option>'),n.prop("disabled",!0))):(n.empty().append('<option value="">Error al cargar historial</option>'),n.prop("disabled",!0))},error:function(a){console.error("Error al cargar historial:",a.responseText),n.empty().append('<option value="">Error al cargar historial</option>'),n.prop("disabled",!0)}})}function E(){const a=$("#select_historial_encargado_segunda_seccion");a.empty().append('<option value="">Seleccionar un encargado primero...</option>'),a.prop("disabled",!0)}function P(){const a=$("#select_historial_ayudante_segunda_seccion");a.empty().append('<option value="">Seleccionar un ayudante primero...</option>'),a.prop("disabled",!0)}function x(){const e=$("#programa_id").val();$.ajax({url:`/programas/${e}/partes-nvc`,method:"GET",success:function(a){a.success?(partesNVTable.clear(),a.data.forEach(function(a,e){const o=a.numero,n=a.es_primero?"disabled":"",r=a.es_ultimo?"disabled":"";let i=`\n                            <div class="btn-group" role="group">\n                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="moveParteNVUp(${a.id})" title="Subir" ${n}>\n                                    <i class="fas fa-chevron-up"></i>\n                                </button>\n                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="moveParteNVDown(${a.id})" title="Bajar" ${r}>\n                                    <i class="fas fa-chevron-down"></i>\n                                </button>\n                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="editParteNV(${a.id})" title="Editar">\n                                    <i class="fas fa-edit"></i>\n                                </button>\n                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteParteNV(${a.id})" title="Eliminar">\n                                    <i class="fas fa-trash"></i>\n                                </button>\n                            </div>\n                        `,s=[o,a.parte_abreviacion||"-",a.encargado_nombre||"-",a.tema||"-",a.tiempo||"-",i];partesNVTable.row.add(s)}),partesNVTable.draw()):console.error("Error en la respuesta:",a)},error:function(e){console.error("Error al cargar las partes de Nuestra Vida Cristiana:",e.responseText),a("alert-container","danger","Error al cargar las partes de Nuestra Vida Cristiana")}})}function M(a){f(a,"up",x)}function z(a){f(a,"down",x)}function N(e){!function(e){isEditMode=!0,$("#parteProgramaNVModalLabel").text("Editar Asignación de Nuestra Vida Cristiana"),$("#saveParteNVBtn").text("Actualizar Asignación"),$("#modal-alert-container-nv").empty(),$("#parte_id_nv").hide(),$("#parte_display_nv").show(),$("#encargado_reemplazado_display_nv").val(""),$("#encargado_reemplazado_id_nv").val(""),$("#encargado_reemplazado_display_nv").closest(".col-md-6").show(),$("#btn-agregar-reemplazado-nv").show(),$.ajax({url:`/partes-programa/${e}`,method:"GET",success:function(e){if(e.success){const a=e.data;$("#parte_programa_nv_id").val(a.id),$("#programa_id_parte_nv").val(a.programa_id),$("#tiempo_parte_nv").val(a.tiempo),$("#tema_parte_nv").val(a.tema),$("#parte_id_nv").val(a.parte_id).trigger("change"),$("#encargado_display_nv").val(a.encargado.name),$("#encargado_id_nv").val(a.encargado.id),$("#btn-buscar-encargado-nv").prop("disabled",!1),$("#btn-agregar-reemplazado-nv").prop("disabled",!1),a.encargado_reemplazado&&($("#encargado_reemplazado_display_nv").val(a.encargado_reemplazado.name),$("#encargado_reemplazado_id_nv").val(a.encargado_reemplazado.id),$("#btn-eliminar-reemplazado-nv").prop("disabled",!1)),o=a.parte_id,$("#parte_id").empty().append('<option value="">Cargando...</option>'),$.ajax({url:`/partes-seccion/${o}`,method:"GET",success:function(a){if(a.success){const e=a.data;$("#parte_id_nv").empty(),$("#parte_id_nv").append(`<option value="${e.id}" data-tiempo="${e.tiempo||""}" selected>${e.nombre} (${e.abreviacion})</option>`),$("#parte_display_nv").val(e.nombre),$("#parte_id_hidden_nv").val(e.id),e.tiempo&&$("#tiempo_parte_nv").val(e.tiempo)}else $("#parte_id_nv").empty().append('<option value="">Error al cargar la parte</option>')},error:function(a){console.error("Error al cargar parte de sección:",a),$("#parte_id_nv").empty().append('<option value="">Error al cargar</option>')}}),$("#parteProgramaNVModal").modal("show")}else a("alert-container","danger",e.message||"Error al cargar los datos de la parte");var o},error:function(e){console.error("Error al cargar la parte:",e.responseText),a("alert-container","danger","Error al cargar los datos de la parte")}})}(e)}function C(a){r(a,x)}function T(a,e){const o=$("#select_historial_encargado_parte_nv");o.empty(),o.append('<option value="">Cargando historial...</option>'),o.prop("disabled",!0),$.ajax({url:`/usuarios/${a}/historial-participaciones`,method:"GET",data:{parte_id:e,tipo:"encargado"},success:function(a){a.success?(o.empty(),a.data.length>0?(o.append('<option value="">Seleccionar participación...</option>'),a.data.forEach(function(a){const e=new Date(a.fecha),n=`${`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}|${a.parte_abreviacion}|${a.nombre_usuario||"Usuario"}`;o.append(`<option value="${a.programa_id}">${n}</option>`)}),o.prop("disabled",!1),o.val(a.data[0].programa_id).trigger("change")):(o.append('<option value="">No hay participaciones registradas como encargado</option>'),o.prop("disabled",!0))):(o.empty(),o.append('<option value="">Error al cargar historial</option>'),o.prop("disabled",!0))},error:function(a){o.empty(),o.append('<option value="">Error al cargar historial</option>'),o.prop("disabled",!0),console.error(a)}})}partesTable=$("#partesTable").DataTable({language:{url:"/js/datatables-es-ES.json"},responsive:!0,paging:!1,ordering:!1,order:[[0,"asc"]],info:!1,searching:!1,columnDefs:[{orderable:!1,targets:0},{orderable:!1,targets:[1,2,3,4,5]}]}),o(),partesSegundaSeccionTable=$("#partesSegundaSeccionTable").DataTable({language:{emptyTable:"No hay partes asignadas en la segunda sección",zeroRecords:"No se encontraron partes que coincidan con la búsqueda"},responsive:!0,paging:!1,ordering:!1,order:[[0,"asc"]],info:!1,searching:!1,columnDefs:[{orderable:!1,targets:0},{orderable:!1,targets:[1,2,3,4,5,6,7]}]}),partesNVTable=$("#partesNVTable").DataTable({language:{emptyTable:"No hay partes asignadas en Nuestra Vida Cristiana",zeroRecords:"No se encontraron partes que coincidan con la búsqueda"},responsive:!0,ordering:!1,paging:!1,info:!1,searching:!1,columnDefs:[{orderable:!1,targets:"_all"}]}),e(),x(),$("#parteProgramaForm").submit(function(e){e.preventDefault(),function(){const e=$("#saveParteBtn"),n=e.find(".spinner-border");e.prop("disabled",!0),n.removeClass("d-none"),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#modal-alert-container").empty();const r=$("#tiempo_parte").val();if(!r||r<1)return $("#tiempo_parte").addClass("is-invalid"),$("#tiempo_parte").siblings(".invalid-feedback").text("El campo Tiempo es obligatorio y debe ser mayor a 0."),e.prop("disabled",!1),void n.addClass("d-none");let i="",s="";$("#parteProgramaModal").hasClass("show")?userIsCoordinator||(i="leccion_parte",s=$("#leccion_parte").val()):$("#parteProgramaSegundaSeccionModal").hasClass("show")&&(i="leccion_segunda_seccion",s=$("#leccion_segunda_seccion").val());if(i&&(!s||""===s.trim()))return $(`#${i}`).addClass("is-invalid"),$(`#${i}`).siblings(".invalid-feedback").text("El campo Lección es obligatorio."),e.prop("disabled",!1),void n.addClass("d-none");const t=$("#encargado_id").val(),c=$("#encargado_reemplazado_id").val();if(t&&c&&t===c)return a("modal-alert-container","warning","El Encargado y el Encargado Reemplazado no pueden ser la misma persona."),e.prop("disabled",!1),void n.addClass("d-none");const d={programa_id:$("#programa_id_parte").val(),parte_id:isEditMode?$("#parte_id_hidden").val():$("#parte_id").val(),tiempo:$("#tiempo_parte").val(),tema:$("#tema_parte").val(),encargado_id:$("#encargado_id").val(),encargado_reemplazado_id:$("#encargado_reemplazado_id").val(),sala_id:$("#sala_id").val(),_token:$('meta[name="csrf-token"]').attr("content")};s&&(d.leccion=s);const l=isEditMode?`/partes-programa/${$("#parte_programa_id").val()}`:"/partes-programa";"PUT"==(isEditMode?"PUT":"POST")&&(d._method="PUT");$.ajax({url:l,method:"POST",data:d,success:function(a){a.success&&($("#parteProgramaModal").modal("hide"),o(),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3))},error:function(e){var o;if(422===e.status){const a=e.responseJSON.errors;for(const e in a){let o=e;"tiempo"===e&&(o="tiempo_parte"),"tema"===e&&(o="tema_parte"),"leccion"===e&&i&&(o=i),$(`#${o}`).addClass("is-invalid"),$(`#${o}`).siblings(".invalid-feedback").text(a[e][0])}}else{a("alert-container","danger",(null==(o=e.responseJSON)?void 0:o.message)||`Error ${e.status}: ${e.statusText}`)}},complete:function(){e.prop("disabled",!1),n.addClass("d-none")}})}()}),$("#parteProgramaNVForm").submit(function(e){e.preventDefault(),function(){const e=$("#saveParteNVBtn"),o=e.find(".spinner-border");e.prop("disabled",!0),o.removeClass("d-none"),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text("");const n=$("#tiempo_parte_nv").val();if(!n||n<1)return $("#tiempo_parte_nv").addClass("is-invalid"),$("#tiempo_parte_nv").siblings(".invalid-feedback").text("El campo Tiempo es obligatorio y debe ser mayor a 0."),e.prop("disabled",!1),void o.addClass("d-none");const r=$("#encargado_id_nv").val(),i=$("#encargado_reemplazado_id_nv").val();if(r&&i&&r===i)return a("modal-alert-container-nv","warning","El Encargado y el Encargado Reemplazado no pueden ser la misma persona."),e.prop("disabled",!1),void o.addClass("d-none");const s={programa_id:$("#programa_id_parte_nv").val(),parte_id:$("#parte_id_nv").val(),tiempo:$("#tiempo_parte_nv").val(),tema:$("#tema_parte_nv").val(),encargado_id:$("#encargado_id_nv").val(),encargado_reemplazado_id:$("#encargado_reemplazado_id_nv").val(),sala_id:$("#sala_id_nv").val(),_token:$('meta[name="csrf-token"]').attr("content")},t=isEditMode?`/partes-programa/${$("#parte_programa_nv_id").val()}`:"/partes-programa";"PUT"==(isEditMode?"PUT":"POST")&&(s._method="PUT");$.ajax({url:t,method:"POST",data:s,success:function(a){a.success&&($("#parteProgramaNVModal").modal("hide"),x(),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3))},error:function(e){var o;if(422===e.status){const a=e.responseJSON.errors;for(const e in a){let o=e;"tiempo"===e&&(o="tiempo_parte_nv"),"tema"===e&&(o="tema_parte_nv"),"leccion"===e&&(o="leccion_parte_nv"),$(`#${o}`).addClass("is-invalid"),$(`#${o}`).siblings(".invalid-feedback").text(a[e][0])}}else{a("alert-container","danger",(null==(o=e.responseJSON)?void 0:o.message)||`Error ${e.status}: ${e.statusText}`)}},complete:function(){e.prop("disabled",!1),o.addClass("d-none")}})}()}),$(document).on("change","#parte_id",function(){const a=$(this).find("option:selected").data("tiempo"),e=$(this).val();a?$("#tiempo_parte").val(a):$("#tiempo_parte").val(""),e?$("#btn-buscar-encargado").prop("disabled",!1):$("#btn-buscar-encargado").prop("disabled",!0),$("#encargado_id").val(""),$("#encargado_display").val(""),$("#btn-historial-encargado").prop("disabled",!0),$("#btn-agregar-reemplazado").prop("disabled",!0)}),$(document).on("change","#parte_id_nv",function(){const a=$(this).find("option:selected").data("tiempo"),e=$(this).val();a?$("#tiempo_parte_nv").val(a):$("#tiempo_parte_nv").val(""),e?$("#btn-buscar-encargado-nv").prop("disabled",!1):$("#btn-buscar-encargado-nv").prop("disabled",!0),$("#encargado_id_nv").val(""),$("#encargado_display_nv").val(""),$("#btn-agregar-reemplazado-nv").prop("disabled",!0)}),$("#fecha").on("change",function(){const a=$(this).val(),e=$("#programa_id").val();if(!a)return void alert("Por favor seleccione una fecha válida");$("#fecha_programa_hidden").val(a);const o={fecha:a,estado:$("#estado").val()||1,orador_inicial:$("#orador_inicial").val()||null,presidencia:$("#presidencia").val()||null,cancion_pre:$("#cancion_pre").val()||null,cancion_en:$("#cancion_en").val()||null,cancion_post:$("#cancion_post").val()||null,orador_final:$("#orador_final").val()||null};$.ajax({url:`/programas/${e}`,type:"PUT",data:o,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){a.success?($("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3)):alert("Error al guardar la fecha: "+(a.message||"Error desconocido"))},error:function(a){let e="Error al guardar la fecha";if(a.responseJSON&&a.responseJSON.errors){e+=": "+Object.values(a.responseJSON.errors).flat().join(", ")}else a.responseJSON&&a.responseJSON.message&&(e+=": "+a.responseJSON.message);alert(e)}})}),$("#editProgramaForm").submit(function(e){e.preventDefault();const o=$("#programa_id").val(),n=$("#updateProgramaBtn"),r=n.find(".spinner-border");n.prop("disabled",!0),r.removeClass("d-none"),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#alert-container").empty(),$.ajax({url:`/programas/${o}`,method:"PUT",data:$(this).serialize(),success:function(e){e.success?(a("alert-container","success","Programa actualizado exitosamente"),setTimeout(function(){window.location.reload()},1500)):a("alert-container","danger",e.message||"Error al actualizar el programa")},error:function(e){if(422===e.status){const a=e.responseJSON.errors;for(const e in a)$(`#${e}`).addClass("is-invalid"),$(`#${e}`).siblings(".invalid-feedback").text(a[e][0])}else a("alert-container","danger","Error al actualizar el programa")},complete:function(){n.prop("disabled",!1),r.addClass("d-none")}})}),$("#parteProgramaSegundaSeccionForm").submit(function(o){o.preventDefault(),function(){const o=$("#encargado_id_segunda_seccion").val(),n=$("#ayudante_id_segunda_seccion").val(),r=$("#parte_id_segunda_seccion").val();if(o&&n&&o===n)return void a("modal-alert-container-segunda-seccion","warning","El Estudiante y el Ayudante no pueden ser la misma persona.");const i=$("#encargado_reemplazado_id_segunda_seccion").val();if(o&&i&&o===i)return void a("modal-alert-container-segunda-seccion","warning","El Estudiante y el Estudiante Reemplazado no pueden ser la misma persona.");const s=$("#ayudante_reemplazado_id_segunda_seccion").val();if(n&&s&&n===s)return void a("modal-alert-container-segunda-seccion","warning","El Ayudante y el Ayudante Reemplazado no pueden ser la misma persona.");if(r){const e=$("#parte_id_segunda_seccion").find("option:selected").data("tipo");if(!o||""===o)return a("modal-alert-container-segunda-seccion","warning","Para esta Asignación es obligatorio seleccionar un Estudiante."),void $("#encargado_display_segunda_seccion").addClass("is-invalid");if(!(2!=e&&3!=e||n&&""!==n))return a("modal-alert-container-segunda-seccion","warning","Para esta Asignación es obligatorio seleccionar un Ayudante."),void $("#ayudante_display_segunda_seccion").addClass("is-invalid")}const t=$("#tiempo_segunda_seccion").val();if(!t||t<1)return a("modal-alert-container-segunda-seccion","warning","El campo Tiempo es obligatorio y debe ser mayor a 0."),void $("#tiempo_segunda_seccion").addClass("is-invalid");const c=isEditMode,d=c?`/partes-programa/${$("#parte_programa_segunda_seccion_id").val()}`:"/partes-programa",l=c?"PUT":"POST",p=$("#parteProgramaSegundaSeccionForm").serialize(),u=$("#saveParteSegundaSeccionBtn"),g=u.find(".spinner-border");u.prop("disabled",!0),g.removeClass("d-none"),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#modal-alert-container-segunda-seccion").empty(),$.ajax({url:d,method:l,data:p,success:function(a){a.success&&($("#parteProgramaSegundaSeccionModal").modal("hide"),e(),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3))},error:function(e){var o;if(422===e.status){const a=e.responseJSON.errors;for(const e in a){let o=e;"tiempo"===e&&(o="tiempo_segunda_seccion"),"encargado_id"===e&&(o="encargado_id_segunda_seccion"),"ayudante_id"===e&&(o="ayudante_id_segunda_seccion"),"parte_id"===e&&(o="parte_id_segunda_seccion"),"leccion"===e&&(o="leccion_segunda_seccion"),$(`#${o}`).addClass("is-invalid"),$(`#${o}`).siblings(".invalid-feedback").text(a[e][0])}}else{a("alert-container","danger",(null==(o=e.responseJSON)?void 0:o.message)||`Error ${e.status}: ${e.statusText}`)}},complete:function(){u.prop("disabled",!1),g.addClass("d-none")}})}()}),$(document).on("change","#parte_id_segunda_seccion",function(){const a=$(this).val(),e=$("#btn-buscar-encargado-segunda"),o=$("#btn-buscar-ayudante-segunda"),n=$(this).find("option:selected").data("tiempo");$("#encargado_display_segunda_seccion").val(""),$("#encargado_id_segunda_seccion").val(""),$("#ayudante_display_segunda_seccion").val(""),$("#ayudante_id_segunda_seccion").val(""),window.ultimoValorEncargado=null,$("#ayudante_id_segunda_seccion").trigger("change"),$("#btn-encargado-reemplazado-segunda").prop("disabled",!0),$("#btn-ayudante-reemplazado-segunda").prop("disabled",!0),a?(e.prop("disabled",!1).attr("title","Buscar Estudiante"),o.prop("disabled",!0).attr("title","Seleccionar un estudiante primero"),null!=n&&""!==n?$("#tiempo_segunda_seccion").val(n):$("#tiempo_segunda_seccion").val("")):(e.prop("disabled",!0).attr("title","Seleccionar una parte primero"),o.prop("disabled",!0).attr("title","Seleccionar una parte primero"),$("#tiempo_segunda_seccion").val(""))}),$(document).on("change","#sala_id_segunda_seccion",function(){const a=$(this).val(),e=$(this).find("option:selected").text();a?$("#parteProgramaSegundaSeccionModalLabel").text("Nueva Asignación ("+e.split(" - ")[1]+")"):$("#parteProgramaSegundaSeccionModalLabel").text("Nueva Asignación")}),window.openCreateParteModal=function(){isEditMode=!1,$("#saveParteBtn").text("Guardar Asignación"),$("#parteProgramaForm")[0].reset(),$("#modal-alert-container").empty(),$("#parte_id").show(),$("#parte_display").hide(),$("#encargado_reemplazado_display").closest(".col-md-6").hide(),$("#btn-agregar-reemplazado").hide(),$("#parte_programa_id").val(""),$("#btn-buscar-encargado").prop("disabled",!0),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#encargado_id").val(""),$("#encargado_display").val(""),$("#btn-agregar-reemplazado").prop("disabled",!0),$("#encargado_reemplazado_id").val(""),$("#encargado_reemplazado_display").val(""),$("#btn-eliminar-reemplazado").prop("disabled",!0),i(),$("#parteProgramaModal").modal("show")},window.editParte=n,window.deleteParte=r,window.loadPartesSecciones=i,window.loadPartesSeccionesForEdit=s,window.openCreateParteSegundaSeccionModal=function(a=null){isEditMode=!1,null===a&&(a=!1),$("#parteProgramaSegundaSeccionModalLabel").text("Nueva Asignación Seamos Mejores Maestros"),$("#parteProgramaSegundaSeccionForm")[0].reset(),$("#parte_programa_segunda_seccion_id").val(""),$("#saveParteSegundaSeccionBtn").text("Guardar Asignación"),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#modal-alert-container-segunda-seccion").empty(),function(){const a=$("#programa_id").val();$.ajax({url:`/programas/${a}/partes-segunda-seccion-disponibles`,method:"GET",success:function(a){if(a.success){const e=$("#parte_id_segunda_seccion");e.empty().append('<option value="">Seleccionar...</option>'),a.data.forEach(function(a){e.append(`<option value="${a.id}" data-tiempo="${a.tiempo}" data-tipo="${a.tipo}" data-abreviacion="${a.abreviacion}">${a.abreviacion} - ${a.nombre}</option>`)})}},error:function(a){console.error("Error al cargar las partes disponibles:",a.responseText)}})}(),$("#encargado_display_segunda_seccion").val("Seleccionar una parte primero..."),$("#encargado_id_segunda_seccion").val(""),$("#ayudante_display_segunda_seccion").val("Seleccionar encargado y parte primero..."),$("#ayudante_id_segunda_seccion").val(""),$("#campos-reemplazados-segunda-seccion").hide(),$("#btn-agregar-encargado-reemplazado").hide(),$("#btn-agregar-ayudante-reemplazado").hide(),$("#btn-encargado-reemplazado-segunda").hide(),$("#btn-ayudante-reemplazado-segunda").hide(),$("#btn-buscar-encargado-segunda").prop("disabled",!0),$("#btn-buscar-encargado-segunda").attr("title","Seleccionar una parte primero"),$("#btn-buscar-ayudante-segunda").prop("disabled",!0),$("#btn-buscar-ayudante-segunda").attr("title","Seleccionar una parte primero")},window.editParteSegundaSeccion=t,window.deleteParteSegundaSeccion=c,window.moveParteUp=g,window.moveParteDown=_,window.moveParteSegundaSeccionUp=m,window.moveParteSegundaSeccionDown=v,window.clearEncargadoReemplazado=d,window.clearAyudanteReemplazado=l,window.agregarEncargadoReemplazado=p,window.agregarAyudanteReemplazado=function(){const a=$("#ayudante_id_segunda_seccion").val(),e=$("#ayudante_display_segunda_seccion").val();a&&e?($("#ayudante_reemplazado_segunda_seccion").val(e),$("#ayudante_reemplazado_id_segunda_seccion").val(a)):alert("Por favor seleccione un ayudante primero")},window.manejarEncargadoReemplazado=function(){const a=$("#encargado_id_segunda_seccion").val(),e=$("#encargado_display_segunda_seccion").val();a&&e?($("#campos-reemplazados-segunda-seccion").show(),$("#encargado_reemplazado_segunda_seccion").val(e),$("#encargado_reemplazado_id_segunda_seccion").val(a)):alert("Por favor seleccione un encargado primero")},window.manejarAyudanteReemplazado=function(){const a=$("#ayudante_id_segunda_seccion").val(),e=$("#ayudante_display_segunda_seccion").val();a&&e?($("#campos-reemplazados-segunda-seccion").show(),$("#ayudante_reemplazado_segunda_seccion").val(e),$("#ayudante_reemplazado_id_segunda_seccion").val(a)):alert("Por favor seleccione un ayudante primero")},window.openCreateParteNVModal=function(){isEditMode=!1,$("#parteProgramaNVModalLabel").text("Nueva Asignación de Nuestra Vida Cristiana"),$("#saveParteNVBtn").text("Guardar Asignación"),$("#parteProgramaNVForm")[0].reset(),$("#programa_id_parte_nv").val($("#programa_id").val()),$("#modal-alert-container-nv").empty(),$("#parte_id_nv").show(),$("#parte_display_nv").hide(),$("#encargado_reemplazado_display_nv").closest(".col-md-6").hide(),$("#btn-agregar-reemplazado-nv").hide(),$("#parte_programa_nv_id").val(""),$("#btn-buscar-encargado-nv").prop("disabled",!0),$(".is-invalid").removeClass("is-invalid"),$(".invalid-feedback").text(""),$("#encargado_id_nv").val(""),$("#encargado_display_nv").val(""),$("#btn-agregar-reemplazado").prop("disabled",!0),$("#encargado_reemplazado_id_nv").val(""),$("#encargado_reemplazado_display_nv").val(""),$("#btn-eliminar-reemplazado-nv").prop("disabled",!0),function(){const a=$("#programa_id").val();$("#parte_id").empty().append('<option value="">Cargando...</option>'),$.ajax({url:"/partes-secciones",method:"GET",data:{programa_id:a,parte_id:3},success:function(a){if(a.success){const e=$("#parte_id_nv");e.empty(),e.append('<option value="">Seleccionar...</option>'),a.data.forEach(function(a){$("#parte_id_nv").append(`<option value="${a.id}" data-tiempo="${a.tiempo||""}">${a.nombre} (${a.abreviacion})</option>`)})}else console.error("Error al cargar las partes de sección:",a.message)},error:function(a){console.error("Error al cargar las partes de sección:",a.responseText)}})}(),$("#parteProgramaNVModal").modal("show")},window.editParteNV=N,window.deleteParteNV=C,window.moveParteNVUp=M,window.moveParteNVDown=z,window.agregarEncargadoReemplazadoNV=function(){const a=$("#encargado_id_nv").val(),e=$("#encargado_display_nv").val();a&&e?($("#encargado_reemplazado_display_nv").val(e),$("#encargado_reemplazado_id_nv").val(a),$("#btn-eliminar-reemplazado-nv").prop("disabled",!1)):alert("Por favor seleccione un encargado primero")},window.eliminarEncargadoReemplazadoNV=function(){if(!$("#encargado_reemplazado_display_nv").val())return void alert("No hay estudiante reemplazado para eliminar");$("#encargado_reemplazado_id_nv").val(""),$("#encargado_reemplazado_display_nv").val("Sin estudiante reemplazado..."),$("#btn-eliminar-reemplazado-nv").prop("disabled",!0)},$("#confirmarOradorInicial").on("click",function(){const a=$("#select_orador_inicial").val(),e=$("#select_orador_inicial option:selected").text();if(!a)return void alert("Por favor seleccione un orador inicial");let o=e;e.includes(" - ")&&(o=e.split(" - ")[1]);const n=$("#programa_id").val(),r=$("#fecha").val(),i=$("#estado").val(),s={fecha:r,orador_inicial:a,estado:i,presidencia:$("#presidencia").val()||null,cancion_pre:$("#cancion_pre").val()||null,cancion_en:$("#cancion_en").val()||null,cancion_post:$("#cancion_post").val()||null,orador_final:$("#orador_final").val()||null},t=$(this),c=t.html();t.html('<i class="fas fa-spinner fa-spin me-2"></i>Guardando...').prop("disabled",!0),$.ajax({url:`/programas/${n}`,type:"PUT",data:s,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){e.success?($("#orador_inicial").val(a),$("#orador_inicial_display").val(o),$("#buscarOradorInicialModal").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3)):alert("Error al guardar el orador inicial: "+(e.message||"Error desconocido"))},error:function(a){let e="Error al guardar el orador inicial";if(a.responseJSON&&a.responseJSON.errors){e+=": "+Object.values(a.responseJSON.errors).flat().join(", ")}else a.responseJSON&&a.responseJSON.message&&(e+=": "+a.responseJSON.message);alert(e)},complete:function(){t.html(c).prop("disabled",!1)}})}),$("#buscarOradorInicialModal").on("hidden.bs.modal",function(){const a=$("#select_orador_inicial");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando usuarios...</option>');const e=$("#select_historial_orador");e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty().append('<option value="">Seleccione un orador para ver historial...</option>'),e.prop("disabled",!0),$("#buscarOradorInicialModalLabel").html('<i class="fas fa-search me-2"></i>Buscar Orador Inicial')}),$("#select_orador_inicial").on("change",function(){const a=$(this).val();if(!a){const a=$("#select_historial_orador");return a.empty().append('<option value="">Seleccione un orador para ver historial...</option>'),void a.prop("disabled",!0)}$.ajax({url:`/usuarios/${a}/historial-orador`,method:"GET",success:function(a){if(a.success){const e=$("#select_historial_orador");e.empty(),a.data.length>0?(e.append('<option value="">Seleccionar participación...</option>'),a.data.forEach(function(a){const o=new Date(a.fecha),n=`${String(o.getDate()).padStart(2,"0")}/${String(o.getMonth()+1).padStart(2,"0")}/${o.getFullYear()}`,r="inicial"===a.tipo?"Orador Inicial":"Orador Final",i=`${n} - ${a.nombre_usuario} - ${r}`;e.append(`<option value="${a.programa_id}">${i}</option>`)}),e.prop("disabled",!1),e.val(a.data[0].programa_id).trigger("change")):(e.append('<option value="">No hay participaciones registradas</option>'),e.prop("disabled",!0))}else console.error("Error al cargar el historial:",a.message)},error:function(a){console.error("Error al cargar el historial del orador inicial:",a)}})}),$("#confirmarOradorFinal").on("click",function(){const a=$("#select_orador_final").val(),e=$("#select_orador_final option:selected").text();if(!a)return void alert("Por favor seleccione un orador final");let o=e;e.includes(" - ")&&(o=e.split(" - ")[1]);const n=$("#programa_id").val(),r=$("#fecha").val(),i=$("#estado").val(),s={fecha:r,orador_final:a,estado:i,orador_inicial:$("#orador_inicial").val()||null,presidencia:$("#presidencia").val()||null,cancion_pre:$("#cancion_pre").val()||null,cancion_en:$("#cancion_en").val()||null,cancion_post:$("#cancion_post").val()||null},t=$(this),c=t.html();t.html('<i class="fas fa-spinner fa-spin me-2"></i>Guardando...').prop("disabled",!0),$.ajax({url:`/programas/${n}`,type:"PUT",data:s,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){e.success?($("#orador_final").val(a),$("#orador_final_display").val(o),$("#buscarOradorFinalModal").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3)):alert("Error al guardar el orador final: "+(e.message||"Error desconocido"))},error:function(a){let e="Error al guardar el orador final";if(a.responseJSON&&a.responseJSON.errors){e+=": "+Object.values(a.responseJSON.errors).flat().join(", ")}else a.responseJSON&&a.responseJSON.message&&(e+=": "+a.responseJSON.message);alert(e)},complete:function(){t.html(c).prop("disabled",!1)}})}),$("#buscarOradorFinalModal").on("hidden.bs.modal",function(){const a=$("#select_orador_final");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando usuarios...</option>');const e=$("#select_historial_orador_final");e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty().append('<option value="">Seleccione un orador para ver historial...</option>'),e.prop("disabled",!0),$("#buscarOradorFinalModalLabel").html('<i class="fas fa-search me-2"></i>Buscar Orador Final')}),$("#select_orador_final").on("change",function(){const a=$(this).val();if(a)$.ajax({url:`/usuarios/${a}/historial-orador`,method:"GET",success:function(a){if(a.success){const e=$("#select_historial_orador_final");e.empty(),a.data.length>0?(e.append('<option value="">Seleccionar participación...</option>'),a.data.forEach(function(a){const o=new Date(a.fecha),n=`${String(o.getDate()).padStart(2,"0")}/${String(o.getMonth()+1).padStart(2,"0")}/${o.getFullYear()}`,r="inicial"===a.tipo?"Orador Inicial":"Orador Final",i=`${n} - ${a.nombre_usuario} - ${r}`;e.append(`<option value="${a.programa_id}">${i}</option>`)}),e.prop("disabled",!1),e.val(a.data[0].programa_id).trigger("change")):(e.append('<option value="">No hay participaciones registradas</option>'),e.prop("disabled",!0))}else console.error("Error al cargar el historial: "+a.message)},error:function(a){console.error("Error al cargar el historial de orador final",a)}});else{const a=$("#select_historial_orador_final");a.empty().append('<option value="">Seleccione un orador para ver historial...</option>'),a.prop("disabled",!0)}}),$("#confirmarPresidencia").on("click",function(){const a=$("#select_presidencia").val(),e=$("#select_presidencia option:selected").text();if(!a)return void alert("Por favor seleccione un presidente");let o=e;e.includes(" - ")&&(o=e.split(" - ")[1]);const n=$("#programa_id").val(),r=$("#fecha").val(),i=$("#estado").val(),s={fecha:r,presidencia:a,estado:i,orador_inicial:$("#orador_inicial").val()||null,cancion_pre:$("#cancion_pre").val()||null,cancion_en:$("#cancion_en").val()||null,cancion_post:$("#cancion_post").val()||null,orador_final:$("#orador_final").val()||null},t=$(this),c=t.html();t.html('<i class="fas fa-spinner fa-spin me-2"></i>Guardando...').prop("disabled",!0),$.ajax({url:`/programas/${n}`,type:"PUT",data:s,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){e.success?($("#presidencia").val(a),$("#presidencia_display").val(o),$("#buscarPresidenciaModal").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3)):alert("Error al guardar el presidente: "+(e.message||"Error desconocido"))},error:function(a){let e="Error al guardar el presidente";if(a.responseJSON&&a.responseJSON.errors){e+=": "+Object.values(a.responseJSON.errors).flat().join(", ")}else a.responseJSON&&a.responseJSON.message&&(e+=": "+a.responseJSON.message);alert(e)},complete:function(){t.html(c).prop("disabled",!1)}})}),$("#buscarPresidenciaModal").on("hidden.bs.modal",function(){const a=$("#select_presidencia");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando usuarios...</option>');const e=$("#select_historial_presidencia");e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty().append('<option value="">Seleccione un presidente para ver historial...</option>'),e.prop("disabled",!0),$("#buscarPresidenciaModalLabel").html('<i class="fas fa-search me-2"></i>Buscar Presidentes')}),$("#select_presidencia").on("change",function(){const a=$(this).val();if(a)$.ajax({url:`/usuarios/${a}/historial-presidencia`,method:"GET",success:function(a){if(a.success){const e=$("#select_historial_presidencia");e.empty(),a.data.length>0?(e.append('<option value="">Seleccionar participación...</option>'),a.data.forEach(function(a){const o=new Date(a.fecha),n=`${`${String(o.getDate()).padStart(2,"0")}/${String(o.getMonth()+1).padStart(2,"0")}/${o.getFullYear()}`} - ${a.nombre_usuario}`;e.append(`<option value="${a.programa_id}">${n}</option>`)}),e.prop("disabled",!1),e.val(a.data[0].programa_id).trigger("change")):(e.append('<option value="">No hay participaciones registradas</option>'),e.prop("disabled",!0))}else console.error("Error al cargar el historial: "+a.message)},error:function(a){console.error("Error al cargar el historial de presidencia",a)}});else{const a=$("#select_historial_presidencia");a.empty().append('<option value="">Seleccione un presidente para ver historial...</option>'),a.prop("disabled",!0)}}),$("#confirmarCancionInicial").on("click",function(){const a=$("#select_cancion_inicial").val(),e=$("#select_cancion_inicial option:selected").text();if(!a)return void alert("Por favor seleccione una canción");const o=$("#programa_id").val(),n=$("#fecha").val(),r=$("#estado").val(),i={fecha:n,cancion_pre:a,estado:r,orador_inicial:$("#orador_inicial").val()||null,presidencia:$("#presidencia").val()||null,cancion_en:$("#cancion_en").val()||null,cancion_post:$("#cancion_post").val()||null,orador_final:$("#orador_final").val()||null},s=$(this),t=s.html();s.html('<i class="fas fa-spinner fa-spin me-2"></i>Guardando...').prop("disabled",!0),$.ajax({url:`/programas/${o}`,type:"PUT",data:i,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){o.success?($("#cancion_pre").val(a),$("#cancion_pre_display").val(e),$("#buscarCancionInicialModal").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3)):alert("Error al guardar la canción inicial: "+(o.message||"Error desconocido"))},error:function(a){let e="Error al guardar la canción inicial";if(a.responseJSON&&a.responseJSON.errors){e+=": "+Object.values(a.responseJSON.errors).flat().join(", ")}else a.responseJSON&&a.responseJSON.message&&(e+=": "+a.responseJSON.message);alert(e)},complete:function(){s.html(t).prop("disabled",!1)}})}),$("#confirmarCancionIntermedia").on("click",function(){const a=$("#select_cancion_intermedia").val(),e=$("#select_cancion_intermedia option:selected").text();if(!a)return void alert("Por favor seleccione una canción");const o=$("#programa_id").val(),n=$("#fecha").val(),r=$("#estado").val(),i={fecha:n,cancion_en:a,estado:r,orador_inicial:$("#orador_inicial").val()||null,presidencia:$("#presidencia").val()||null,cancion_pre:$("#cancion_pre").val()||null,cancion_post:$("#cancion_post").val()||null,orador_final:$("#orador_final").val()||null},s=$(this),t=s.html();s.html('<i class="fas fa-spinner fa-spin me-2"></i>Guardando...').prop("disabled",!0),$.ajax({url:`/programas/${o}`,type:"PUT",data:i,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){o.success?($("#cancion_en").val(a),$("#cancion_en_display").val(e),$("#buscarCancionIntermediaModal").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3)):alert("Error al guardar la canción intermedia: "+(o.message||"Error desconocido"))},error:function(a){let e="Error al guardar la canción intermedia";if(a.responseJSON&&a.responseJSON.errors){e+=": "+Object.values(a.responseJSON.errors).flat().join(", ")}else a.responseJSON&&a.responseJSON.message&&(e+=": "+a.responseJSON.message);alert(e)},complete:function(){s.html(t).prop("disabled",!1)}})}),$("#confirmarCancionFinal").on("click",function(){const a=$("#select_cancion_final").val(),e=$("#select_cancion_final option:selected").text();if(!a)return void alert("Por favor seleccione una canción");const o=$("#programa_id").val(),n=$("#fecha").val(),r=$("#estado").val(),i={fecha:n,cancion_post:a,estado:r,orador_inicial:$("#orador_inicial").val()||null,presidencia:$("#presidencia").val()||null,cancion_pre:$("#cancion_pre").val()||null,cancion_en:$("#cancion_en").val()||null,orador_final:$("#orador_final").val()||null},s=$(this),t=s.html();s.html('<i class="fas fa-spinner fa-spin me-2"></i>Guardando...').prop("disabled",!0),$.ajax({url:`/programas/${o}`,type:"PUT",data:i,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){o.success?($("#cancion_post").val(a),$("#cancion_post_display").val(e),$("#buscarCancionFinalModal").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},2e3)):alert("Error al guardar la canción final: "+(o.message||"Error desconocido"))},error:function(a){let e="Error al guardar la canción final";if(a.responseJSON&&a.responseJSON.errors){e+=": "+Object.values(a.responseJSON.errors).flat().join(", ")}else a.responseJSON&&a.responseJSON.message&&(e+=": "+a.responseJSON.message);alert(e)},complete:function(){s.html(t).prop("disabled",!1)}})}),$("#buscarCancionInicialModal").on("hidden.bs.modal",function(){const a=$("#select_cancion_inicial");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando canciones...</option>')}),$("#buscarCancionIntermediaModal").on("hidden.bs.modal",function(){const a=$("#select_cancion_intermedia");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando canciones...</option>')}),$("#buscarCancionFinalModal").on("hidden.bs.modal",function(){const a=$("#select_cancion_final");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando canciones...</option>')}),$("#confirmarEncargadoParteNV").on("click",function(){const a=$("#select_encargado_parte_nv").val(),e=$("#select_encargado_parte_nv option:selected").text();if(!a)return void alert("Por favor seleccione un encargado");let o=e;e.includes("|")&&(o=e.split("|")[2]),$("#encargado_id_nv").val(a),$("#encargado_display_nv").val(o),$("#btn-buscar-encargado-nv").prop("disabled",!1),$("#buscarEncargadoParteNVModal").modal("hide")}),$("#buscarEncargadoParteNVModal").on("hidden.bs.modal",function(){const a=$("#select_encargado_parte_nv");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando usuarios...</option>');const e=$("#select_historial_encargado_parte_nv");e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty().append('<option value="">Seleccione un encargado primero...</option>'),e.prop("disabled",!0),$("#buscarEncargadoParteNVModalLabel").html('<i class="fas fa-search me-2"></i>Buscar Encargado NVC')}),window.buscarEncargadoParteNV=function(){const a=$("#parte_id_nv").val();if(!a)return void alert("Por favor seleccione una parte primero");$("#buscarEncargadoParteNVModalLabel").html('<i class="fas fa-search me-2"></i>Buscar Encargado NVC'),$("#buscarEncargadoParteNVModal").modal("show"),$("#confirmarEncargadoParteNV").prop("disabled",!0),$.ajax({url:`/encargados-por-parte-programa/${a}`,method:"GET",success:function(e){if(e.success){const o=$("#select_encargado_parte_nv");o.empty(),o.hasClass("select2-hidden-accessible")||o.select2({theme:"bootstrap-5",placeholder:"Buscar y seleccionar encargado...",allowClear:!0,width:"100%",dropdownParent:$("#buscarEncargadoParteNVModal")}),o.append('<option value="">Seleccionar encargado...</option>'),e.data.forEach(function(a){o.append(`<option value="${a.id}">${a.display_text}</option>`)});const n=$("#select_historial_encargado_parte_nv");n.hasClass("select2-hidden-accessible")||n.select2({theme:"bootstrap-5",placeholder:"Historial del Encargado...",width:"100%",dropdownParent:$("#buscarEncargadoParteNVModal")});const r=$("#encargado_id_nv").val();r&&(o.val(r),T(r,a)),o.off("change.historial_nv").on("change.historial_nv",function(){const a=$(this).val(),e=$("#parte_id_nv").val();if($("#confirmarEncargadoParteNV").prop("disabled",!a),a&&e)T(a,e);else{const a=$("#select_historial_encargado_parte_nv");a.empty().append('<option value="">Seleccione un encargado primero...</option>'),a.prop("disabled",!0)}})}else alert("Error al cargar los usuarios: "+e.message)},error:function(a){alert("Error al cargar los usuarios para encargado NVC"),console.error(a)}})},$("#confirmarEncargadoParte").on("click",function(){const a=$("#select_encargado_parte").val(),e=$("#select_encargado_parte option:selected").text();if(!a)return void alert("Por favor seleccione un encargado");let o=e;e.includes("|")&&(o=e.split("|")[2]),$("#encargado_id").val(a),$("#encargado_display").val(o),$("#btn-historial-encargado").prop("disabled",!1),$("#btn-agregar-reemplazado").prop("disabled",!1),$("#buscarEncargadoParteModal").modal("hide")}),$("#buscarEncargadoParteModal").on("hidden.bs.modal",function(){const a=$("#select_encargado_parte");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando usuarios...</option>')}),$("#buscarEncargadoParteModal").on("hidden.bs.modal",function(){const a=$("#select_encargado_parte");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando usuarios...</option>');const e=$("#select_historial_encargado_parte");e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty().append('<option value="">Seleccione un encargado primero...</option>'),e.prop("disabled",!0),$("#buscarEncargadoParteModalLabel").html('<i class="fas fa-search me-2"></i>Buscar Encargado')}),window.buscarOradorInicial=function(){$("#buscarOradorInicialModal").modal("show"),$.ajax({url:"/usuarios-orador-inicial",method:"GET",success:function(a){if(a.success){const e=$("#select_orador_inicial");e.empty(),e.hasClass("select2-hidden-accessible")||e.select2({theme:"bootstrap-5",placeholder:"Buscar y seleccionar orador...",allowClear:!0,width:"100%",dropdownParent:$("#buscarOradorInicialModal")}),e.append('<option value="">Seleccionar orador inicial...</option>'),a.data.forEach(function(a){let o="Primera vez";if(a.ultima_fecha){const e=new Date(a.ultima_fecha);o=`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}const n=`${o} - ${a.name}`;e.append(`<option value="${a.id}">${n}</option>`)});const o=$("#orador_inicial").val();o&&e.val(o).trigger("change");const n=$("#select_historial_orador");n.hasClass("select2-hidden-accessible")||n.select2({theme:"bootstrap-5",placeholder:"Historial del Encargado...",width:"100%",dropdownParent:$("#buscarOradorInicialModal")})}else alert("Error al cargar los usuarios: "+a.message)},error:function(a){alert("Error al cargar los usuarios para orador inicial"),console.error(a)}})},window.verHistorialOradorInicial=function(){const a=$("#orador_inicial").val();a?($("#buscarOradorInicialModal").modal("show"),$.ajax({url:`/usuarios/${a}/historial-orador`,method:"GET",success:function(a){if(a.success){const e=$("#select_historial_orador");e.empty(),e.hasClass("select2-hidden-accessible")||e.select2({theme:"bootstrap-5",placeholder:"Historial del Encargado...",width:"100%",dropdownParent:$("#buscarOradorInicialModal")}),a.data.length>0?(e.append('<option value="">Seleccionar participación...</option>'),a.data.forEach(function(a){const o=new Date(a.fecha),n=`${String(o.getDate()).padStart(2,"0")}/${String(o.getMonth()+1).padStart(2,"0")}/${o.getFullYear()}`,r="inicial"===a.tipo?"Orador Inicial":"Orador Final",i=`${n} - ${a.nombre_usuario} - ${r}`;e.append(`<option value="${a.programa_id}">${i}</option>`)}),e.prop("disabled",!1),e.val(a.data[0].programa_id).trigger("change"),$("#buscarOradorInicialModalLabel").html(`<i class="fas fa-history me-2"></i>Historial de ${a.data[0].nombre_usuario}`)):(e.append('<option value="">No hay participaciones registradas</option>'),e.prop("disabled",!0))}else alert("Error al cargar el historial: "+a.message)},error:function(a){alert("Error al cargar el historial del orador inicial"),console.error(a)}})):alert("No hay orador inicial seleccionado para mostrar historial")},window.buscarOradorFinal=function(){$("#buscarOradorFinalModal").modal("show"),$.ajax({url:"/usuarios-orador-inicial",method:"GET",success:function(a){if(a.success){const e=$("#select_orador_final");e.empty(),e.hasClass("select2-hidden-accessible")||e.select2({theme:"bootstrap-5",placeholder:"Buscar y seleccionar orador...",allowClear:!0,width:"100%",dropdownParent:$("#buscarOradorFinalModal")}),e.append('<option value="">Seleccionar orador final...</option>'),a.data.forEach(function(a){let o="Primera vez";if(a.ultima_fecha){const e=new Date(a.ultima_fecha);o=`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}const n=`${o} - ${a.name}`;e.append(`<option value="${a.id}">${n}</option>`)});const o=$("#orador_final").val();o&&e.val(o).trigger("change");const n=$("#select_historial_orador_final");n.hasClass("select2-hidden-accessible")||n.select2({theme:"bootstrap-5",placeholder:"Historial del Encargado...",width:"100%",dropdownParent:$("#buscarOradorFinalModal")})}else alert("Error al cargar los usuarios: "+a.message)},error:function(a){alert("Error al cargar los usuarios para orador final"),console.error(a)}})},window.verHistorialOradorFinal=function(){const a=$("#orador_final").val();a?($("#buscarOradorFinalModal").modal("show"),$.ajax({url:`/usuarios/${a}/historial-orador`,method:"GET",success:function(a){if(a.success){const e=$("#select_historial_orador_final");e.empty(),e.hasClass("select2-hidden-accessible")||e.select2({theme:"bootstrap-5",placeholder:"Historial de Encargado...",width:"100%",dropdownParent:$("#buscarOradorFinalModal")}),a.data.length>0?(e.append('<option value="">Seleccionar participación...</option>'),a.data.forEach(function(a){const o=new Date(a.fecha),n=`${String(o.getDate()).padStart(2,"0")}/${String(o.getMonth()+1).padStart(2,"0")}/${o.getFullYear()}`,r="inicial"===a.tipo?"Orador Inicial":"Orador Final",i=`${n} - ${a.nombre_usuario} - ${r}`;e.append(`<option value="${a.programa_id}">${i}</option>`)}),e.prop("disabled",!1),e.val(a.data[0].programa_id).trigger("change"),$("#buscarOradorFinalModalLabel").html(`<i class="fas fa-history me-2"></i>Historial de ${a.data[0].nombre_usuario}`)):(e.append('<option value="">No hay participaciones registradas</option>'),e.prop("disabled",!0))}else alert("Error al cargar el historial: "+a.message)},error:function(a){alert("Error al cargar el historial del orador final"),console.error(a)}})):alert("No hay orador final seleccionado para mostrar historial")},window.buscarPresidencia=function(){$("#buscarPresidenciaModal").modal("show"),$.ajax({url:"/usuarios-presidencia",method:"GET",success:function(a){if(a.success){const e=$("#select_presidencia");e.empty(),e.hasClass("select2-hidden-accessible")||e.select2({theme:"bootstrap-5",placeholder:"Buscar y seleccionar presidente...",allowClear:!0,width:"100%",dropdownParent:$("#buscarPresidenciaModal")}),e.append('<option value="">Seleccionar presidente...</option>'),a.data.forEach(function(a){let o="Primera vez";if(a.ultima_fecha){const e=new Date(a.ultima_fecha);o=`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}const n=`${o} - ${a.name}`;e.append(`<option value="${a.id}">${n}</option>`)});const o=$("#presidencia").val();o&&e.val(o).trigger("change");const n=$("#select_historial_presidencia");n.hasClass("select2-hidden-accessible")||n.select2({theme:"bootstrap-5",placeholder:"Historial del Encargado...",width:"100%",dropdownParent:$("#buscarPresidenciaModal")})}else alert("Error al cargar los usuarios: "+a.message)},error:function(a){alert("Error al cargar los usuarios para presidencia"),console.error(a)}})},window.verHistorialPresidencia=function(){const a=$("#presidencia").val();a?($("#buscarPresidenciaModal").modal("show"),$.ajax({url:`/usuarios/${a}/historial-presidencia`,method:"GET",success:function(a){if(a.success){const e=$("#select_historial_presidencia");e.empty(),e.hasClass("select2-hidden-accessible")||e.select2({theme:"bootstrap-5",placeholder:"Historial del Encargado...",width:"100%",dropdownParent:$("#buscarPresidenciaModal")}),a.data.length>0?(e.append('<option value="">Seleccionar participación...</option>'),a.data.forEach(function(a){const o=new Date(a.fecha),n=`${`${String(o.getDate()).padStart(2,"0")}/${String(o.getMonth()+1).padStart(2,"0")}/${o.getFullYear()}`} - ${a.nombre_usuario}`;e.append(`<option value="${a.programa_id}">${n}</option>`)}),e.prop("disabled",!1),e.val(a.data[0].programa_id).trigger("change"),$("#buscarPresidenciaModalLabel").html(`<i class="fas fa-history me-2"></i>Historial de ${a.data[0].nombre_usuario}`)):(e.append('<option value="">No hay participaciones registradas</option>'),e.prop("disabled",!0))}else alert("Error al cargar el historial: "+a.message)},error:function(a){alert("Error al cargar el historial de presidencia"),console.error(a)}})):alert("No hay presidente seleccionado para mostrar historial")},window.buscarCancionInicial=function(){$("#buscarCancionInicialModal").modal("show"),h("select_cancion_inicial","#cancion_pre")},window.buscarCancionIntermedia=function(){$("#buscarCancionIntermediaModal").modal("show"),h("select_cancion_intermedia","#cancion_en")},$("#confirmarAgregarReemplazado").on("click",function(){const a=$("#encargado_id").val(),e=$("#encargado_display").val();$("#encargado_reemplazado_id").val(a),$("#encargado_reemplazado_display").val(e),$("#btn-eliminar-reemplazado").prop("disabled",!1),$("#confirmarAgregarReemplazadoModal").modal("hide")}),$("#confirmarEliminarReemplazado").on("click",function(){$("#encargado_reemplazado_id").val(""),$("#encargado_reemplazado_display").val(""),$("#btn-eliminar-reemplazado").prop("disabled",!0),$("#confirmarEliminarReemplazadoModal").modal("hide")}),window.buscarCancionFinal=function(){$("#buscarCancionFinalModal").modal("show"),h("select_cancion_final","#cancion_post")},window.buscarEncargadoParte=b,window.verHistorialEncargadoParte=function(){const a=$("#encargado_id").val(),e=$("#parte_id").val();e?($("#buscarEncargadoParteModalLabel").html('<i class="fas fa-history me-2"></i>Historial de Encargado'),b(),a&&setTimeout(function(){y(a,e)},500)):alert("No hay parte seleccionada para mostrar historial")},window.agregarEncargadoReemplazado=p,window.eliminarEncargadoReemplazado=function(){$("#encargado_reemplazado_display").val()?($("#encargado_reemplazado_id").val(""),$("#encargado_reemplazado_display").val(""),$("#btn-eliminar-reemplazado").prop("disabled",!0)):alert("No hay estudiante reemplazado para eliminar")},window.buscarEncargadoSegundaSeccion=function(){const a=$("#parte_id_segunda_seccion").val();if($("#parte_id_segunda_seccion").find("option:selected").data("abreviacion"),!a)return void alert("Por favor seleccione una parte primero");const e=$("#parte_id_segunda_seccion").find("option:selected").data("tipo"),o=$("#encargado_id_segunda_seccion").val();$("#buscarEncargadoSegundaSeccionModal").modal("show");const n=$("#filtro_sexo_encargado_segunda_container");1==e?(n.show(),$('input[name="filtro_sexo_encargado_segunda"][value="2"]').closest(".form-check").hide(),$('input[name="filtro_sexo_encargado_segunda"][value="1"]').closest(".form-check").show(),$('input[name="filtro_sexo_encargado_segunda"][value="1"]').prop("checked",!0),$('input[name="filtro_sexo_encargado_segunda"]').prop("disabled",!0)):(n.show(),$('input[name="filtro_sexo_encargado_segunda"][value="1"]').closest(".form-check").show(),$('input[name="filtro_sexo_encargado_segunda"][value="2"]').closest(".form-check").show(),$('input[name="filtro_sexo_encargado_segunda"]').prop("disabled",!1)),$("#confirmarEncargadoSegundaSeccion").prop("disabled",!0);let r=2;o&&$.ajax({url:"/verificar-sexo-encargado",method:"GET",data:{encargado_id:o},async:!1,success:function(a){a.success&&a.encargado_sexo&&(r=a.encargado_sexo)}}),$(document).off("change.filtro_sexo_encargado_segunda").on("change.filtro_sexo_encargado_segunda",'input[name="filtro_sexo_encargado_segunda"]',function(){!function(a){const e=$('input[name="filtro_sexo_encargado_segunda"]:checked').val();$("#select_encargado_segunda_seccion").prop("disabled",!0),$.ajax({url:`/encargados-por-parte-programa-smm/${a}`,method:"GET",data:{sexo:e},success:function(a){if(a.success){const e=$("#select_encargado_segunda_seccion"),o=e.val();e.empty(),e.append('<option value="">Seleccionar encargado...</option>'),a.data.forEach(function(a){e.append(`<option value="${a.id}">${a.display_text}</option>`)}),o&&e.find(`option[value="${o}"]`).length>0?e.val(o).trigger("change"):e.val("").trigger("change"),$("#select_encargado_segunda_seccion").prop("disabled",!1)}else alert("Error al cargar los usuarios: "+a.message)},error:function(a){alert("Error al cargar los usuarios participantes"),console.error(a)}})}(a)}),1==e&&(r=1),$(`input[name="filtro_sexo_encargado_segunda"][value="${r}"]`).prop("checked",!0),$.ajax({url:`/encargados-por-parte-programa-smm/${a}`,method:"GET",data:{sexo:r},async:!1,success:function(e){if(e.success){const o=$("#select_encargado_segunda_seccion");o.empty(),o.hasClass("select2-hidden-accessible")||o.select2({theme:"bootstrap-5",placeholder:"Buscar y seleccionar encargado...",allowClear:!0,width:"100%",dropdownParent:$("#buscarEncargadoSegundaSeccionModal")}),o.append('<option value="">Seleccionar encargado...</option>'),e.data.forEach(function(a){o.append(`<option value="${a.id}">${a.display_text}</option>`)});const n=$("#select_historial_encargado_segunda_seccion");n.hasClass("select2-hidden-accessible")||n.select2({theme:"bootstrap-5",placeholder:"Historial del Encargado...",width:"100%",dropdownParent:$("#buscarEncargadoSegundaSeccionModal")});const r=$("#encargado_id_segunda_seccion").val();r&&(o.val(r),w(r,a)),o.off("change.select_encargado_segunda_seccion").on("change.select_encargado_segunda_seccion",function(){const a=$(this).val(),e=$("#parte_id_segunda_seccion").val();$("#confirmarEncargadoSegundaSeccion").prop("disabled",!a),a?w(a,e):E()})}else alert("Error al cargar los usuarios: "+e.message)},error:function(a){alert("Error al cargar los usuarios participantes"),console.error(a)}})},window.buscarAyudanteSegundaSeccion=function(){const a=$("#parte_id_segunda_seccion").val(),e=$("#encargado_id_segunda_seccion").val(),o=$("#ayudante_id_segunda_seccion").val(),n=$("#parte_id_segunda_seccion").find("option:selected").data("tipo"),r=$("#encargado_display_segunda_seccion").val();if($("#buscarAyudanteSegundaSeccionModalLabel").text(`Buscar Ayudante para: ${r||"..."}`),!a)return void alert("Por favor seleccione una parte primero");if(1==n)return void alert("No se puede buscar ayudante para esta Asignación");$("#buscarAyudanteSegundaSeccionModal").modal("show");const i=$("#filtro_sexo_ayudante_segunda_container");let s=null;3==n?(i.show(),o?$.ajax({url:"/verificar-sexos-usuarios",method:"GET",data:{encargado_id:e,ayudante_id:o},async:!1,success:function(a){a.success&&a.ayudante_sexo&&(s=a.ayudante_sexo)}}):$.ajax({url:"/verificar-sexo-encargado",method:"GET",data:{encargado_id:e},async:!1,success:function(a){a.success&&a.encargado_sexo&&(s=a.encargado_sexo)}}),1==s?$('input[name="filtro_sexo_ayudante_segunda"][value="1"]').prop("checked",!0):2==s?$('input[name="filtro_sexo_ayudante_segunda"][value="2"]').prop("checked",!0):($('input[name="filtro_sexo_ayudante_segunda"][value="2"]').prop("checked",!0),s=2)):i.hide(),$("#confirmarAyudanteSegundaSeccion").prop("disabled",!0),$(document).off("change.select_ayudante_segunda_seccion").on("change.select_ayudante_segunda_seccion","#select_ayudante_segunda_seccion",function(){const e=$(this).val();$("#confirmarAyudanteSegundaSeccion").prop("disabled",!e),e?function(a,e){const o=$("#select_historial_ayudante_segunda_seccion");o.empty().append('<option value="">Cargando historial...</option>'),o.prop("disabled",!1),$.ajax({url:`/usuarios/${a}/${e}/historial-segunda-seccion`,method:"GET",success:function(a){a.success?(o.empty(),a.historial.length>0?(o.append('<option value="">Seleccionar participación...</option>'),a.historial.forEach(function(a){const e=new Date(a.fecha),n=`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`,r=a.encargado_nombre_formateado||"",i=a.ayudante_nombre_formateado||"",s=`${n}|${a.sala_abreviacion}|${a.parte_abreviacion}|ES|${r}|AY|${i}`;o.append(`<option value="${a.programa_id}">${s}</option>`)}),o.prop("disabled",!1),a.historial.length>0&&o.val(a.historial[0].programa_id).trigger("change")):(o.append('<option value="">No hay participaciones registradas</option>'),o.prop("disabled",!0))):(o.empty().append('<option value="">Error al cargar historial</option>'),o.prop("disabled",!0))},error:function(a){console.error("Error al cargar historial:",a.responseText),o.empty().append('<option value="">Error al cargar historial</option>'),o.prop("disabled",!0)}})}(e,a):P()}),3==n&&$(document).off("change.filtro_sexo_ayudante_segunda").on("change.filtro_sexo_ayudante_segunda",'input[name="filtro_sexo_ayudante_segunda"]',function(){!function(a,e,o){const n=$('input[name="filtro_sexo_ayudante_segunda"]:checked').val();$("#select_ayudante_segunda_seccion").prop("disabled",!0);let r=`/ayudantes-por-parte-programa-smm/${a}`,i={};e&&(i.encargado_id=e);3==o&&n&&(i.sexo=n);$.ajax({url:r,method:"GET",data:i,success:function(a){if(a.success){const e=$("#select_ayudante_segunda_seccion"),o=e.val();e.empty(),e.append('<option value="">Seleccionar ayudante...</option>'),a.has_gender_sections?a.data.forEach(function(a){a.is_section?e.append(`<option disabled style="font-weight: bold;">${a.display_text}</option>`):e.append(`<option value="${a.id}">${a.display_text}</option>`)}):a.data.forEach(function(a){e.append(`<option value="${a.id}">${a.display_text}</option>`)}),o&&e.find(`option[value="${o}"]`).length>0?e.val(o).trigger("change"):e.val("").trigger("change"),$("#select_ayudante_segunda_seccion").prop("disabled",!1)}else alert("Error al cargar los usuarios: "+a.message)},error:function(a){alert("Error al cargar los usuarios ayudantes"),console.error(a)}})}(a,e,n)});let t=`/ayudantes-por-parte-programa-smm/${a}`,c={};e&&(c.encargado_id=e),3==n&&s&&(c.sexo=s),$.ajax({url:t,method:"GET",data:c,async:!1,success:function(a){if(a.success){const e=$("#select_ayudante_segunda_seccion");e.empty(),e.hasClass("select2-hidden-accessible")||e.select2({theme:"bootstrap-5",placeholder:"Buscar y seleccionar ayudante...",allowClear:!0,width:"100%",dropdownParent:$("#buscarAyudanteSegundaSeccionModal")}),e.append('<option value="">Seleccionar ayudante...</option>'),a.has_gender_sections?a.data.forEach(function(a){a.is_section?e.append(`<option disabled style="font-weight: bold;">${a.display_text}</option>`):e.append(`<option value="${a.id}">${a.display_text}</option>`)}):a.data.forEach(function(a){e.append(`<option value="${a.id}">${a.display_text}</option>`)});const o=$("#select_historial_ayudante_segunda_seccion");o.hasClass("select2-hidden-accessible")||o.select2({theme:"bootstrap-5",placeholder:"Seleccionar un ayudante primero...",allowClear:!0,width:"100%",dropdownParent:$("#buscarAyudanteSegundaSeccionModal")});const n=$("#ayudante_id_segunda_seccion").val();n&&e.val(n).trigger("change")}else alert("Error al cargar los usuarios: "+a.message)},error:function(a){alert("Error al cargar los usuarios ayudantes"),console.error(a)}})},window.verHistorialAyudanteSegundaSeccion=function(){const a=$("#ayudante_id_segunda_seccion").val();a?alert("Función verHistorialAyudanteSegundaSeccion() - Por implementar\nAyudante ID: "+a):alert("No hay ayudante seleccionado")},window.clearHistorialEncargado=function(){},window.clearHistorialAyudante=function(){},window.loadHistorialEncargado=function(a){},window.loadHistorialEncargadoSegundaSeccion=w,window.clearHistorialEncargadoSegundaSeccion=E,$("#confirmarEncargadoSegundaSeccion").on("click",function(){const e=$("#select_encargado_segunda_seccion").val(),o=$("#select_encargado_segunda_seccion option:selected").text();if(!e)return void alert("Por favor seleccione un encargado");let n=o;if(o.includes(" - ")){const a=o.split(" - ");n=a[a.length-1].replace(/\s*\([^)]*\)\s*$/,"").trim()}else if(o.includes("|")){const a=o.split("|");n=a[a.length-1].replace(/\s*\([^)]*\)\s*$/,"").trim()}else n=n.replace(/\s*\([^)]*\)\s*$/,"").trim();$("#encargado_id_segunda_seccion").val(e),$("#encargado_display_segunda_seccion").val(n);const r=$("#parte_id_segunda_seccion").val(),i=$("#ayudante_id_segunda_seccion").val();if(r&&i){if(2==$("#parte_id_segunda_seccion").find("option:selected").data("tipo"))return $.ajax({url:"/verificar-sexos-usuarios",method:"GET",data:{encargado_id:e,ayudante_id:i},success:function(e){if(e.success){e.encargado_sexo!==e.ayudante_sexo?($("#ayudante_id_segunda_seccion").val("").trigger("change"),$("#ayudante_display_segunda_seccion").val(""),$("#btn-ayudante-reemplazado-segunda").prop("disabled",!0),P(),a("modal-alert-container-segunda-seccion","info","El ayudante ha sido removido porque tiene un sexo diferente al encargado."),S(),$("#buscarEncargadoSegundaSeccionModal").modal("hide")):(S(),$("#buscarEncargadoSegundaSeccionModal").modal("hide"))}else S(),$("#buscarEncargadoSegundaSeccionModal").modal("hide")},error:function(a){S(),$("#buscarEncargadoSegundaSeccionModal").modal("hide")}}),void u()}u(),S(),$("#buscarEncargadoSegundaSeccionModal").modal("hide")}),$("#buscarEncargadoSegundaSeccionModal").on("hidden.bs.modal",function(){const a=$("#select_encargado_segunda_seccion");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando usuarios...</option>');const e=$("#select_historial_encargado_segunda_seccion");e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty().append('<option value="">Seleccionar un encargado primero...</option>'),e.prop("disabled",!0)}),$("#confirmarAyudanteSegundaSeccion").on("click",function(){const a=$("#select_ayudante_segunda_seccion").val(),e=$("#select_ayudante_segunda_seccion option:selected").text();if(!a)return void alert("Por favor seleccione un ayudante");let o=e;if(e.includes("|")){const a=e.split("|");a.length>=4&&(o=a[4].trim())}$("#ayudante_id_segunda_seccion").val(a),$("#ayudante_display_segunda_seccion").val(o),u(),$('input[name="filtro_sexo_ayudante_segunda"]').prop("checked",!1),$('input[name="filtro_sexo_ayudante_segunda"]').prop("disabled",!1),$('input[name="filtro_sexo_ayudante_segunda"][value="1"]').closest(".form-check").show(),$('input[name="filtro_sexo_ayudante_segunda"][value="2"]').closest(".form-check").show(),$("#filtro_sexo_ayudante_segunda_container").hide(),$("#buscarAyudanteSegundaSeccionModal").modal("hide")}),$("#buscarAyudanteSegundaSeccionModal").on("hidden.bs.modal",function(){const a=$("#select_ayudante_segunda_seccion");a.hasClass("select2-hidden-accessible")&&a.select2("destroy"),a.empty().append('<option value="">Cargando usuarios...</option>');const e=$("#select_historial_ayudante_segunda_seccion");e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty().append('<option value="">Seleccionar un ayudante primero...</option>'),e.prop("disabled",!0)}),$("#parteProgramaNVModal").on("hidden.bs.modal",function(){$("#encargado_reemplazado_display_nv").closest(".col-md-6").show(),$("#btn-agregar-reemplazado-nv").show()}),window.moveParteSegundaSeccionUp=m,window.moveParteSegundaSeccionDown=v,window.editParteSegundaSeccion=t,window.deleteParteSegundaSeccion=c,window.moveParteUp=g,window.moveParteDown=_,window.editParte=n,window.deleteParte=r,window.moveParteNVUp=M,window.moveParteNVDown=z,window.editParteNV=N,window.deleteParteNV=C}),window.verAsignacionDesdeTabla=function(e){e?($("#verAsignacionModal").modal("show"),function(e){const o=$("#asignacion-card-container");o.html('\n        <div class="text-center">\n            <div class="spinner-border text-primary" role="status">\n                <span class="visually-hidden">Cargando...</span>\n            </div>\n        </div>\n    '),$.ajax({url:`/programas/asignacion-por-id/${e}`,method:"GET",success:function(e){e.success?function(a){const e=$("#asignacion-card-container");if(!a)return void e.html('\n            <div class="alert alert-info text-center">\n                <i class="fas fa-info-circle me-2"></i>No se encontró la asignación.\n            </div>\n        ');const o=a.fecha_formateada,n=a.nombre_encargado||"";let r=a.nombre_ayudante||"";const i=parseInt(a.sala_id)||1,s=1===i,t=2===i,c=3===i;let d=`\n        <div class="asignacion-card" id="asignacion-para-imprimir">\n            <h4>ASIGNACIÓN PARA LA REUNIÓN<br>VIDA Y MINISTERIO CRISTIANOS</h4>\n            \n            <div class="info-row">\n                <span class="info-label">Nombre:</span>\n                <span class="info-value">${n}</span>\n            </div>\n            \n            <div class="info-row">\n                <span class="info-label">Ayudante:</span>\n                <span class="info-value">${r||""}</span>\n            </div>\n            \n            <div class="info-row">\n                <span class="info-label">Fecha:</span>\n                <span class="info-value">${o}</span>\n            </div>\n            \n            <div class="info-row">\n                <span class="info-intervencion">Intervención núm.:</span>\n                <span class="info-value">${a.numero_intervencion}</span>\n            </div>\n            \n            <div class="sala-section">\n                <div style="font-weight: bold; margin-bottom: 10px;">Se presentará en:</div>\n                <div class="checkbox-row">\n                    <span class="checkbox ${s?"checked":""}"></span>\n                    <span>Sala principal</span>\n                </div>\n                <div class="checkbox-row">\n                    <span class="checkbox ${t?"checked":""}"></span>\n                    <span>Sala auxiliar 1</span>\n                </div>\n                <div class="checkbox-row">\n                    <span class="checkbox ${c?"checked":""}"></span>\n                    <span>Sala auxiliar 2</span>\n                </div>\n            </div>\n            \n            <div class="nota-section">\n                <div class="nota-title">Nota al estudiante:</div>\n                <div class="nota-text">\n                    En la <i>Guía de actividades</i> encontrará la información que necesita para su intervención. \n                    Repase también las indicaciones que se describen en las Instrucciones para la reunión \n                    Vida y Ministerio Cristianos (S-38).\n                </div>\n                <div class="nota-text mt-2">\n                    S-38-S 11/23\n                </div>\n            </div>\n        </div>\n    `;e.html(d)}(e.data):(a("ver-asignacion-alert-container","danger",e.message||"Error al cargar la asignación."),o.html('\n                    <div class="alert alert-danger text-center">\n                        <i class="fas fa-exclamation-circle me-2"></i>Error al cargar la asignación\n                    </div>\n                '))},error:function(e){var n;a("ver-asignacion-alert-container","danger",(null==(n=e.responseJSON)?void 0:n.message)||"Error al cargar la asignación."),o.html('\n                <div class="alert alert-danger text-center">\n                    <i class="fas fa-exclamation-triangle me-2"></i>Error al cargar la asignación\n                </div>\n            ')}})}(e)):showAlert("alert-container","warning","No se pudo obtener el ID de la asignación.")};
